<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Conduit</title>
    <!-- Import Ionicon icons & Google Fonts our Bootstrap theme relies on -->
    <link href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Titillium+Web:700|Source+Serif+Pro:400,700|Merriweather+Sans:400,700|Source+Sans+Pro:400,300,600,700,300italic,400italic,600italic,700italic" rel="stylesheet" type="text/css">
    <!-- Import the custom Bootstrap 4 theme from our hosted CDN -->
    <link rel="stylesheet" href="//demo.productionready.io/main.css">
  </head>

  <body>
    <script src="elm.js"></script>
    <script>
     var storedSession = localStorage.getItem('session');
     console.log("Stored session ", storedSession);
     var app = Elm.Main.fullscreen(JSON.parse(storedSession) || null);

     app.ports.storeSession.subscribe(function(session) {
       console.log("Storing session ", session);
       localStorage.setItem('session', JSON.stringify(session));
       app.ports.onSessionChange.send(JSON.parse(session));
     });

     window.addEventListener("storage", function(event) {
       if (event.storageArea === localStorage && event.key === "session") {
         console.log("Sending session ", event.newValue);
         app.ports.onSessionChange.send(JSON.parse(event.newValue));
       }
     }, false);
    </script>
  </body>
</html>
